(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var s in o)e.o(o,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:o[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.i18n,o=window.wp.blocks,s=window.wp.element,n=(window.wp.data,window.wp.blockEditor),l=window.wp.components,r=window.wp.apiFetch;var i=e.n(r);const a=JSON.parse('{"UU":"dmg/post-search"}'),d=window.ReactJSXRuntime;(0,o.registerBlockType)(a.UU,{edit:({attributes:e,setAttributes:o})=>{const{align:r,backgroundColor:a,postId:c,postTitle:p,postUrl:g}=e,[u,h]=(0,s.useState)(""),[w,x]=(0,s.useState)([]),[m,j]=(0,s.useState)(1),[b,k]=(0,s.useState)(1),[f,y]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=new AbortController,t=setTimeout((()=>{(async(e="",t=1,o)=>{y(!0);try{let s=`/wp/v2/posts?per_page=5&page=${t}&_fields=id,title,link`,n=!1;e&&(/^\d+$/.test(e)?(s=`/wp/v2/posts/${e}?_fields=id,title,link`,n=!0):s+=`&search=${encodeURIComponent(e)}`);const l=await i()({path:s,parse:!1,signal:o.signal});if(n){const e=await l.json();x(e?.id?[e]:[]),k(1)}else{const e=parseInt(l.headers.get("X-WP-TotalPages")||"1",10),t=await l.json();x(t),k(e)}}catch(e){"AbortError"!==e.name&&console.error("Post fetch failed:",e),x([]),k(1)}finally{y(!1)}})(u,m,e)}),400);return()=>{clearTimeout(t),e.abort()}}),[u,m]);const C=(0,n.useBlockProps)({className:"dmg-read-more"});return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.InspectorControls,{children:[(0,d.jsxs)(l.PanelBody,{title:"Select a Post",initialOpen:!0,children:[(0,d.jsx)(l.TextControl,{label:"Search posts",value:u,onChange:e=>{j(1),h(e)},placeholder:"Search by title or ID",style:{background:"#f6f9fa"}}),f?(0,d.jsx)(l.Spinner,{}):(0,d.jsx)(d.Fragment,{children:w.length?(0,d.jsxs)("div",{className:"dmg-post-results",children:[w.map((e=>(0,d.jsx)(l.Button,{isSecondary:!0,onClick:()=>(e=>{o({postId:e.id,postTitle:e.title.rendered,postUrl:e.link})})(e),style:{display:"block",marginBottom:"6px",textAlign:"left",width:"100%",overflow:"hidden"},children:(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:e.title.rendered||"(No title)"}})},e.id))),(0,d.jsxs)(l.Flex,{justify:"space-between",style:{marginTop:"12px"},children:[(0,d.jsx)(l.Button,{isSmall:!0,disabled:m<=1,onClick:()=>j(m-1),children:"Previous"}),(0,d.jsxs)("span",{style:{fontSize:"80%"},children:[m," / ",b]}),(0,d.jsx)(l.Button,{isSmall:!0,disabled:m>=b,onClick:()=>j(m+1),children:"Next"})]})]}):(0,d.jsx)("p",{children:"No posts found."})})]}),(0,d.jsx)(n.PanelColorSettings,{title:(0,t.__)("Color settings","pindrop-blocks"),initialOpen:!1,colorSettings:[{value:a,onChange:e=>o({backgroundColor:e}),label:(0,t.__)("Background color","pindrop-blocks")}]})]}),(0,d.jsx)(n.BlockControls,{children:(0,d.jsx)(n.AlignmentControl,{value:e.align,onChange:e=>o({align:e})})}),(0,d.jsx)("p",{...C,style:{textAlign:r,backgroundColor:a},children:g?(0,d.jsxs)(d.Fragment,{children:["Read More: ",(0,d.jsx)("a",{href:g,children:p||"Selected Post"})]}):(0,d.jsx)("em",{children:"No post selected."})})]})},save:({attributes:e})=>{const{align:t,backgroundColor:o,postId:s,postTitle:l,postUrl:r}=e,i=n.useBlockProps.save({className:"dmg-read-more"});return(0,d.jsxs)("p",{...i,style:{textAlign:t,backgroundColor:o},children:["Read More: ",(0,d.jsx)("a",{href:r,children:l})]})}})})();